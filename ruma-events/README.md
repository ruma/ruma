# ruma-events

[![crates.io page](https://img.shields.io/crates/v/ruma-events.svg)](https://crates.io/crates/ruma-events)
[![docs.rs page](https://docs.rs/ruma-events/badge.svg)](https://docs.rs/ruma-events/)
![license: MIT](https://img.shields.io/crates/l/ruma-events.svg)

**ruma-events** contains serializable types for the events in the [Matrix](https://matrix.org/) specification that can be shared by client and server code.

## Minimum Rust version

ruma-events requires Rust 1.40.0 or later.

## Documentation

ruma-events has [comprehensive documentation](https://docs.rs/ruma-events) available on docs.rs.

## Structure

```rust
// src/enums.rs

// these are full events (with room_id)
enum AnyRoomEvent {
    Message(AnyMessageEvent),
    State(AnyStateEvent),
    RedactedMessage(AnyRedactedMessageEvent),
    RedactedState(AnyRedactedStateEvent),
}

// Stub events are going to be renamed to Sync eventually as they are
// the events that come from a sync response with no room_id field
enum AnyRoomEventStub {
    Message(AnyMessageEventStub),
    State(AnyStateEventStub),
    RedactedMessage(AnyRedactedMessageEventStub),
    RedactedState(AnyRedactedStateEventStub),
}

// These are generated by a macro and corespond to the old collections::all/only::RoomEvent enums
enum AnyStateEvent {
    RoomAliases(StateEvent<AliasesEventContent>),
    // ... the rest of the state events
}

enum AnyStateEventStub {
    RoomAliases(StateEventStub<AliasesEventContent>),
    // ... the rest of the state events
}

enum AnyStrippedStateEventStub {
    RoomAliases(StrippedStateEventStub<AliasesEventContent>),
    // ... the rest of the state events
}

// Now for the redacted events that are being added.
// There are also redacted stub and stripped versions of state events and
// full (with room_id) and stub version of message events. Message events
// are all EmptyRedactedMessageEvent since no content fields are kept.
enum AnyRedactedStateEvent {
    RoomAliases(EmptyRedactedStateEvent),
    RoomCreate(RedactedStateEvent<RedactedCreateEventContent>), // ... the rest of the state events
}

// src/event_kinds.rs

// The event structs, these follow the same patterns with different fields.
// There are full, stub, and stripped versions of state events, full and stub message events,
// full and stub ephemeral, basic event, to device event. Message and state have empty redacted
// versions of each event and state has full, stub, and stripped versions of generic redacted events.
struct StateEvent<C> {
    content: C,
    // ... fields for state event
}

struct RedactedStateEvent<C> {
    content: C,
    // this is the "m.whatever"
    event_type: String,
    // ... fields for redacted state event
}

// So there are stripped and stub redacted state events and full and stub empty redacted
// message events also
struct EmptyRedactedStateEvent {
    // this is the "m.whatever"
    event_type: String,
    // ... fields for redacted state event no `content` field
}

// src/[room]/[name_of_event_content].rs

// The last piece is the content structs
struct CreateEventContent {
    // whatever fields are specified by the spec
    specific_content_fields: Foo,
}

// The few content structs that have any content after being redacted
struct RedactedCreateEventContent {
    // whatever fields are specified by the spec after redaction
    specific_content_fields: Foo,
}
```
